package test1;

import java.io.IOException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import jxl.Sheet;
import jxl.Workbook;
import jxl.format.Alignment;
import jxl.format.Border;
import jxl.format.BorderLineStyle;
import jxl.format.UnderlineStyle;
import jxl.read.biff.BiffException;
import jxl.write.Number;
import jxl.write.WritableCellFeatures;
import jxl.write.WritableCellFormat;
import jxl.write.WritableFont;
import jxl.write.WritableSheet;
import jxl.write.WritableWorkbook;
import jxl.write.WriteException;
import jxl.write.biff.RowsExceededException;

public class Assess {
	
	
	private static String halfdaynoclear_postil ;
	private static String fulldaynoclear_postil ;
	private static String fiveMinutesLate_postil ;
	private static String fifteenMinutesLate_postil ;	
	private static String thirtyMinutesLate_postil ;	
	private static String halfdayLate_postil ;	
	private static HashMap<String,Integer> AssessDayInformation = null; 
	private static HashMap<String,Integer> LateDayInformation = null; 
	
	
	private static ArrayList<String> nameList;
	private static Workbook DataResouceWorkbook;
	private static String dataResouceWorkbookSheetName;
	private static WritableWorkbook DataInputwWritableWorkbook;
	private static String dataWriteableWorkbookSheetName;
	
	
	
	public static void InitialDataInformation
	       (ArrayList<String> nameList,
			Workbook DataResouceWorkbook,
			String dataResouceWorkbookSheetName,
			WritableWorkbook DataInputwWritableWorkbook,
			String dataWriteableWorkbookSheetName
	    		   )
	 {
		Assess.nameList = nameList;
		Assess.DataResouceWorkbook = DataResouceWorkbook;
		Assess.dataResouceWorkbookSheetName = dataResouceWorkbookSheetName;
		Assess.DataInputwWritableWorkbook = DataInputwWritableWorkbook;
		Assess.dataWriteableWorkbookSheetName = dataWriteableWorkbookSheetName;
		
	 }
		

	public static String getHalfdaynoclear_postil() {
		return halfdaynoclear_postil;
	}


	public static String getFulldaynoclear_postil() {
		return fulldaynoclear_postil;
	}

	public static HashMap<String,Integer> getAssessDayInformation() {
		return AssessDayInformation;
	}



	public static int CaculationAssessDaysByPerson(String Personname,
			                                       Workbook workbook,
			                                       String Sheetname) 
			
			throws BiffException, IOException {
		
	
		Sheet caculateSheet = workbook.getSheet(0);		
		int rows = caculateSheet.getRows();
		int columns   =  caculateSheet.getColumns();
		
		int resultcount = 0;
		for (int i = 0; i < rows; i++) {
			
			caculateSheet.getCell(0, i).getContents();
			
			if (Personname.equals(caculateSheet.getCell(0, i).getContents())) {
				resultcount++;
			}
			
		}
		
		return resultcount;
		
	}
	
	
	
	
	public static void SingleOnePersonCaculationAssessActualDays(
			String Personname,
            Workbook workbook,
            String Sheetname) 

         throws BiffException, IOException {
				 
		  int fulldayclear = Assess.CaculationAssessDaysByPerson(Personname, workbook, Sheetname);
		  		  
		  HashMap<String,Integer> result = new HashMap<String, Integer>();
		  
		  int actualdayclear = 0;
		  int morningnoclear = 0;
		  int afternoonnoclear = 0;
		  int halfdayclear = 0;
		  int fulldaynoclear = 0;
		  
		  String fulldaynoclear_postilinformation = null;
		  String halfdaynoclear_postilinformation = null;
		  	  
		  result.put("fulldayclear", fulldayclear);
		  

          Sheet caculateSheet = workbook.getSheet(Sheetname);

          int rows = caculateSheet.getRows();
          int columns   =  caculateSheet.getColumns();

          for (int i = 0; i < rows; i++) {
    	   		  
    		  if (Personname.equals(caculateSheet.getCell(0, i).getContents()))
    			  
    		     {
    			  
    			  if ((caculateSheet.getCell(6, i).getContents()).equals("") == true) 
    			  
    			   {
     				  if ((caculateSheet.getCell(7, i).getContents()).equals("") == true) 
    				  {
     					  
     					 fulldaynoclear++;
     					 
     					 if (fulldaynoclear_postilinformation == null) {
     						 fulldaynoclear_postilinformation  = 
     					     caculateSheet.getCell(2, i).getContents() + " 全天未打"+"\n";
						 }
     					 
     					 else {
     						 
     						fulldaynoclear_postilinformation 
        					 += caculateSheet.getCell(2, i).getContents() + " 全天未打"+"\n";
							
						 }
     					 
    				  }
     				  
     				  else {
						
     					 morningnoclear++;
     					 
     					 if (halfdaynoclear_postilinformation == null) {
     						 
     						halfdaynoclear_postilinformation =
     						caculateSheet.getCell(2, i).getContents() + " 上午未打"+"\n";
							
						}
     					 
     					 else {
     						 halfdaynoclear_postilinformation 
         					 += caculateSheet.getCell(2, i).getContents() + " 上午未打"+"\n";
						 }
     					
					   }
    				  
				   }
    			  
    			   else {
    				  
    				  if ((caculateSheet.getCell(7, i).getContents()).equals("") == true) 
    				  {
    					  
    					  afternoonnoclear++;
      					 if (halfdaynoclear_postilinformation ==null) {
     						 
      						halfdaynoclear_postilinformation =
      						caculateSheet.getCell(2, i).getContents() + " 下午未打"+"\n";
 							
 						}
      					 
      					 else {
      						 halfdaynoclear_postilinformation 
          					 += caculateSheet.getCell(2, i).getContents() + " 下午未打"+"\n";
 						 }
      					
 					   }
    					  
    					  
    				  }
					
				   }
    			  
    		    }

           
        
        halfdayclear = morningnoclear + afternoonnoclear;   
        actualdayclear = fulldayclear - halfdayclear -fulldaynoclear;
        
        result.put("actualdayclear", actualdayclear);
        result.put("halfdayclear", halfdayclear);
        result.put("morningnoclear", morningnoclear);
        result.put("afternoonnoclear", afternoonnoclear);
        result.put("fulldaynoclear", fulldaynoclear);  
        
        AssessDayInformation = result;
        
        
        fulldaynoclear_postil = fulldaynoclear_postilinformation;
        halfdaynoclear_postil = halfdaynoclear_postilinformation;
        

     }
	
	
	
	
	public static void SinglePersonWriteDate(
			String Personname,
            WritableWorkbook workbook,
            String Sheetname) throws RowsExceededException, WriteException, IOException
	
	{
		
		
		WritableSheet test2sheet = workbook.getSheet(Sheetname);
		//设置字体居中格式等等
		
		//设置字体
		WritableFont font = new WritableFont(
				WritableFont.createFont("宋体"), 
				12, WritableFont.BOLD, 
				false, 
				UnderlineStyle.NO_UNDERLINE);
		
		//设置单元格格式
		WritableCellFormat cellFormat = new WritableCellFormat(font);
		cellFormat.setAlignment(Alignment.CENTRE);
		cellFormat.setBorder(Border.ALL, BorderLineStyle.THIN);
		
		
		for (int i = 4; i < 32; i++) {
			
			if ((test2sheet.getCell(1, i).getContents()).equals(Personname))
			{
				
					Number fulldayclear = new Number(2, i,  AssessDayInformation.get("fulldayclear"),cellFormat);
					
					test2sheet.addCell(fulldayclear);
					
					Number actualdayclear = new Number(3, i,  AssessDayInformation.get("actualdayclear"),cellFormat);	
					test2sheet.addCell(actualdayclear);
					
					Number halfdayclear = new Number(4, i,  AssessDayInformation.get("halfdayclear"),cellFormat);	
					WritableCellFeatures Halfdaynoclear_postil = new WritableCellFeatures();
					Halfdaynoclear_postil.setComment(Assess.getHalfdaynoclear_postil(),3.00,25.00);
					halfdayclear.setCellFeatures(Halfdaynoclear_postil);
					test2sheet.addCell(halfdayclear);
					
					Number fulldaynoclear = new Number(5, i,  AssessDayInformation.get("fulldaynoclear"),cellFormat);
					WritableCellFeatures fulldaynoclear_postil = new WritableCellFeatures();
					fulldaynoclear_postil.setComment(Assess.getFulldaynoclear_postil(),3.00,25.00);
					fulldaynoclear.setCellFeatures(fulldaynoclear_postil);
					test2sheet.addCell(fulldaynoclear);
					
					return;
				
			}			
		}
		

		
	}
	
	
    public static void CalculateAllPersonDayInformations() throws BiffException, IOException, RowsExceededException, WriteException 
    
    {
    	for(String name : nameList)
    	{
    		
    		SingleOnePersonCaculationAssessActualDays(name, DataResouceWorkbook, dataResouceWorkbookSheetName); 		
    		SinglePersonWriteDate(name, DataInputwWritableWorkbook, dataWriteableWorkbookSheetName);
    		
    		
    		
    	}
    	DataInputwWritableWorkbook.write();
		DataInputwWritableWorkbook.close();
		
	}
	
	
	
	public static void SingleOnePersonCaculationLateTimes(			
			String Personname,
            Workbook workbook,
            String Sheetname) throws ParseException
	
	{
		Sheet caculateSheet = workbook.getSheet(0);	
        int rows = caculateSheet.getRows();
        int columns   =  caculateSheet.getColumns();
        
		DateFormat LateTimesdaDateFormat = new SimpleDateFormat("HH:mm");
	    String fifteenMinutes= "00:15";
	    String fiveMinutes= "00:05";
	    String thirtyMinutes= "00:30";
	    
		java.util.Date fifteenMinutestimes = null;
		java.util.Date fiveMinutestimes = null;
		java.util.Date thirtyMinutestimes = null;
		java.util.Date NowLateTimes = null;
		
		fifteenMinutestimes = LateTimesdaDateFormat.parse(fifteenMinutes);
		fiveMinutestimes = LateTimesdaDateFormat.parse(fiveMinutes);
		thirtyMinutestimes = LateTimesdaDateFormat.parse(thirtyMinutes);
		
		String NowLate = null;
		
		
		int fiveMinutesLate = 0 ;
		int fifteenMinutesLate = 0 ;	
		int thirtyMinutesLate = 0 ;	
		int halfdayLate = 0 ;	
		
		String fiveMinutesLate_postilinformation = null;
		String fifteenMinutesLate_postilinformation = null;
		String thirtyMinutesLate_postilinformation = null;
		String halfdayLate_postilinformation = null;

	    
        for (int i = 0; i < rows; i++) 
          {
  	   		  
  		   if (Personname.equals(caculateSheet.getCell(0, i).getContents()))
  			  
  		      {
  			   
                if ((caculateSheet.getCell(10, i).getContents()).equals("") == false)
                {
                	
                	NowLate = caculateSheet.getCell(10, i).getContents();
                	NowLateTimes = LateTimesdaDateFormat.parse(NowLate);
                	
                	
                	if (NowLateTimes.getTime() <= fiveMinutestimes.getTime() )
                	{
                		
                		fiveMinutesLate++;
                		
    					 if (fiveMinutesLate_postilinformation == null) {
     						 
    						 fiveMinutesLate_postilinformation =
    						caculateSheet.getCell(10, i).getContents() + "\n";
							
						}
    					 
    					 else {
    						 fiveMinutesLate_postilinformation
        					 += caculateSheet.getCell(10, i).getContents() + "\n";
						 }                		
					}
                	
                	else if (NowLateTimes.getTime() > fiveMinutestimes.getTime() && NowLateTimes.getTime()<fifteenMinutestimes.getTime()) {
						
                		fifteenMinutesLate++;
                		
   					    if (fifteenMinutesLate_postilinformation == null) {
 						 
   					    	fifteenMinutesLate_postilinformation =
						  caculateSheet.getCell(10, i).getContents() + "\n";
						
					     }
					 
					   else {
						   fifteenMinutesLate_postilinformation
    					   += caculateSheet.getCell(10, i).getContents() + "\n";
					     }   
                		
					}
                	
                	else if (condition) {
						
					}
                	
                	else {
						
					}
                	
                	
	
                }

  			    
  		      };
  			  
  			  
  			  
  			  
  			  
  			  
  			  
  		     
  		     
		
		
		
		
		
	        }
        
	}
	
    
	
	public static void SingleOnePersonCaculationWriteLateDays() {
		
		
		
	}
	

	
	

}
